/* ========================================
   RESPONSIVE DESIGN SYSTEM - WriteMath!
   Perfect margins, intelligent scaling, zero scrollbars
   ======================================== */

/* CSS Custom Properties - Responsive Margins & Spacing */
:root {
  /* Theme Colors - Cool Blue / Electric Cyan Theme */
  --main-bg: linear-gradient(135deg, #0acffe 0%, #495aff 100%);
  --text-color: #ffffff;
  --canvas-bg: #fff;
  --canvas-border: #495aff;
  --canvas-border-active: #0acffe;
  --canvas-border-processing: #00e676;
  --button-bg: #1d2671;
  --button-bg-hover: #495aff;
  --button-bg-active: #00e676;
  --tooltip-bg: rgba(20, 20, 50, 0.8);
  --tooltip-text: #fff;
  --primary-color: #495aff;
  --secondary-color: #00e676;
  --error-color: #ff1744;
  --success-color: #00e676;
  --hint-text: #fff;
  --transition-speed: 0.3s;

  /* Intelligent Margin System - Perfectly Even on All Sides */
  --margin-mobile-portrait: clamp(12px, 3vw, 20px);
  --margin-mobile-landscape: clamp(10px, 2vh, 16px);
  --margin-tablet-portrait: clamp(20px, 4vw, 40px);
  --margin-tablet-landscape: clamp(16px, 2.5vh, 30px);
  --margin-desktop: clamp(30px, 5vw, 60px);

  /* Dynamic Padding System */
  --padding-mobile: clamp(8px, 2vw, 16px);
  --padding-tablet: clamp(12px, 2.5vw, 24px);
  --padding-desktop: clamp(16px, 3vw, 32px);

  /* Content Scaling */
  --content-scale-portrait: 0.9;
  --content-scale-landscape: 0.85;
  --content-scale-desktop: 1;

  /* Safe Area Calculations */
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-left: env(safe-area-inset-left, 0px);
  --safe-area-right: env(safe-area-inset-right, 0px);
}

/* ========================================
   DEVICE DETECTION & BASE SETUP
   ======================================== */

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  /* Prevent unwanted zooming on mobile */
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  text-size-adjust: 100%;

  /* Smooth scrolling (when needed) */
  scroll-behavior: smooth;

  /* Lock viewport */
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

body {
  /* Lock body dimensions */
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  min-height: 100vh;
  min-height: -webkit-fill-available;

  /* Remove scrollbars completely */
  overflow: hidden;
  overflow-x: hidden;
  overflow-y: hidden;

  /* Flexbox centering */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  /* Typography */
  font-family: 'Fredoka One', 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', 'Trebuchet MS', 'Verdana', 'Arial Black', cursive, sans-serif;

  /* Background */
  background: var(--main-bg);
  background-attachment: fixed;
  color: var(--text-color);

  /* Smooth transitions */
  transition: background var(--transition-speed);

  /* Perfect margins on all sides - Desktop default */
  padding: var(--margin-desktop);
  padding-top: calc(var(--margin-desktop) + var(--safe-area-top));
  padding-bottom: calc(var(--margin-desktop) + var(--safe-area-bottom));
  padding-left: calc(var(--margin-desktop) + var(--safe-area-left));
  padding-right: calc(var(--margin-desktop) + var(--safe-area-right));

  /* Prevent text selection on UI elements */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;

  /* Prevent pull-to-refresh */
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

/* Main app container */
#app {
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

/* ========================================
   SCREEN CONTAINERS - Perfectly Centered
   ======================================== */

.screen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  padding: var(--padding-desktop);
  overflow: hidden;

  background: transparent;
  z-index: 1;

  transition: opacity var(--transition-speed),
    transform var(--transition-speed);
}

.screen.hidden {
  opacity: 0;
  pointer-events: none;
  transform: scale(0.98);
}

/* Content wrapper for better control */
.screen>* {
  max-width: 100%;
  flex-shrink: 0;
}

/* ========================================
   TYPOGRAPHY - Responsive & Scalable
   ======================================== */

h1 {
  font-size: clamp(1.8rem, 5vw + 0.5rem, 3.5rem);
  margin-bottom: clamp(0.3em, 1.5vh, 0.6em);
  color: #fff;
  text-shadow: 2px 2px 10px rgba(73, 90, 255, 0.6);
  text-align: center;
  line-height: 1.2;
}

h2 {
  font-size: clamp(1.3rem, 3.5vw + 0.3rem, 2.2rem);
  color: #fff;
  margin: clamp(0.4em, 1.5vh, 0.8em) 0;
  font-weight: normal;
  text-align: center;
  line-height: 1.3;
}

h3 {
  font-size: clamp(1.1rem, 2.8vw + 0.2rem, 1.8rem);
  color: #fff;
  margin: clamp(0.4em, 1vh, 0.7em) 0;
  font-weight: normal;
  text-align: center;
  line-height: 1.3;
}

/* ========================================
   BUTTONS - Touch-Friendly & Responsive
   ======================================== */

.mode-btn,
.difficulty-btn,
.big-btn,
.settings-btn {
  font-family: inherit;
  font-size: clamp(0.95rem, 2.2vw + 0.2rem, 1.4rem);
  padding: clamp(0.5em, 1.8vh, 0.8em) clamp(1em, 3vw, 2.5em);

  border: none;
  border-radius: clamp(10px, 2vw, 20px);

  background: #fff;
  color: var(--primary-color);
  font-weight: bold;

  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  cursor: pointer;

  margin: clamp(0.2em, 0.8vh, 0.4em) clamp(0.2em, 1vw, 0.4em);

  transition: all 0.25s ease;

  /* Touch-friendly minimum size */
  min-height: 48px;
  min-width: 48px;

  /* Prevent text wrapping */
  white-space: nowrap;

  /* Touch feedback */
  -webkit-tap-highlight-color: transparent;
}

.mode-btn:hover,
.difficulty-btn:hover,
.big-btn:hover,
.settings-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.mode-btn:active,
.difficulty-btn:active,
.big-btn:active,
.settings-btn:active {
  transform: translateY(0);
}

.mode-btn.selected,
.difficulty-btn.selected {
  background: var(--primary-color);
  color: #fff;
  transform: scale(1.05);
}

.big-btn {
  background: var(--button-bg);
  color: #fff;
  font-size: clamp(1.1rem, 2.5vw + 0.3rem, 1.6rem);
  padding: clamp(0.6em, 2vh, 0.85em) clamp(1.5em, 4vw, 3em);
  margin-top: clamp(0.6em, 2vh, 1em);
  box-shadow: 0 6px 24px rgba(255, 78, 80, 0.2);
}

.settings-btn {
  background: #fff;
  color: #222;
  font-size: clamp(1rem, 2.2vw + 0.2rem, 1.3rem);
}

/* ========================================
   GAME MODES & DIFFICULTY SELECTORS
   ======================================== */

.game-modes,
.difficulty-select {
  display: flex;
  gap: clamp(0.6em, 2vw, 1.2em);
  margin-bottom: clamp(0.8em, 2vh, 1.4em);
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  width: 100%;
  max-width: min(600px, 90vw);
}

/* ========================================
   DROPDOWN CONTROLS
   ======================================== */

.dropdown-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
  max-width: min(340px, 85vw);
}

.dropdown-wrapper select {
  width: 100%;
  font-family: inherit;
  font-size: clamp(1.1rem, 2.3vw + 0.2rem, 1.4rem);
  padding: clamp(0.6em, 1.8vh, 0.8em) clamp(1.2em, 3vw, 2.2em);
  padding-right: 3em;

  border: 2px solid var(--primary-color);
  border-radius: clamp(12px, 2.5vw, 22px);

  background: #fff;
  color: var(--primary-color);
  font-weight: bold;

  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);

  margin: clamp(0.15em, 0.5vh, 0.3em);

  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  cursor: pointer;
  transition: all 0.2s ease;
}

.dropdown-wrapper select:focus,
.dropdown-wrapper select:hover {
  border-color: var(--button-bg-hover);
  box-shadow: 0 0 0 3px rgba(255, 78, 80, 0.2);
}

.dropdown-arrow {
  position: absolute;
  right: clamp(0.8em, 2vw, 1.2em);
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  transition: stroke 0.2s;
  width: clamp(16px, 3vw, 22px);
  height: clamp(16px, 3vw, 22px);
}

.dropdown-wrapper select:focus+.dropdown-arrow,
.dropdown-wrapper select:hover+.dropdown-arrow {
  stroke: var(--button-bg-hover);
}

/* ========================================
   MODAL DIALOGS
   ======================================== */

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;

  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);

  display: flex;
  align-items: center;
  justify-content: center;

  z-index: 100;
  padding: var(--margin-mobile-portrait);

  transition: opacity var(--transition-speed);
}

.modal.hidden {
  opacity: 0;
  pointer-events: none;
}

.modal-content {
  background: #fff;
  border-radius: clamp(16px, 4vw, 32px);
  padding: clamp(1.5em, 4vh, 2.5em) clamp(1.8em, 5vw, 3em);

  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);

  display: flex;
  flex-direction: column;
  gap: clamp(0.8em, 2vh, 1.4em);

  min-width: min(280px, 80vw);
  max-width: min(500px, 90vw);
  max-height: 85vh;

  align-items: center;
  overflow-y: auto;
}

.modal-content h2,
.modal-content h3 {
  color: var(--primary-color);
}

label {
  font-size: clamp(1rem, 2vw + 0.2rem, 1.2rem);
  color: var(--primary-color);
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
}

select:not(.dropdown-wrapper select),
input[type="checkbox"] {
  margin-top: 0.5em;
  font-size: clamp(1rem, 2vw + 0.1rem, 1.2rem);
  border-radius: clamp(6px, 1.5vw, 10px);
  border: 2px solid var(--primary-color);
  padding: clamp(0.4em, 1.2vh, 0.6em) clamp(0.6em, 2vw, 1em);
  font-family: inherit;
}

/* ========================================
   GAME SCREEN - Main Gameplay Area
   ======================================== */

#game-screen {
  background: var(--main-bg);
  z-index: 2;
  padding: clamp(8px, 1.5vh, 16px);
}

.game-header {
  display: flex;
  justify-content: space-between;
  align-items: center;

  width: 100%;
  max-width: min(650px, 95vw);

  margin: 0 auto clamp(0.5em, 1.5vh, 1em);
  padding: 0 clamp(8px, 2vw, 16px);

  font-size: clamp(0.9rem, 2vw + 0.2rem, 1.4rem);
  color: #fff;
  font-weight: bold;

  flex-wrap: wrap;
  gap: clamp(0.5em, 1.5vw, 1em);
}

.game-header>div {
  flex: 1 1 auto;
  min-width: max-content;
  text-align: center;
}

#model-status {
  text-align: center;
  color: #fff;
  font-size: clamp(0.8rem, 1.8vw + 0.1rem, 1rem);
  margin: clamp(0.3em, 1vh, 0.6em) 0;
  opacity: 0.9;
}

#problem-area {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(0.6em, 1.5vh, 1.2em);
  width: 100%;
  max-width: 100%;
}

#problem,
.problem-large {
  font-size: clamp(1.8rem, 4vw + 0.5rem, 3.5rem);
  color: #fff;
  margin-bottom: clamp(0.3em, 1vh, 0.5em);
  text-shadow: 3px 3px 12px rgba(10, 207, 254, 0.5);
  text-align: center;
  line-height: 1.2;
}

/* ========================================
   CANVAS AREA - Handwriting Input
   ======================================== */

.play-vertical {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(8px, 1.5vh, 16px);
  width: 100%;
  max-width: 100%;
}

.canvas-panel {
  width: 100%;
  max-width: min(660px, 92vw);

  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(8px);

  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: clamp(12px, 3vw, 20px);

  padding: clamp(8px, 2vh, 14px) clamp(10px, 2.5vw, 18px);

  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
}

.panel-title {
  color: #fff;
  font-size: clamp(0.95rem, 2vw + 0.15rem, 1.2rem);
  margin: clamp(4px, 1vh, 8px) 0 clamp(8px, 1.5vh, 12px);
  text-align: center;
  font-weight: bold;
}

.hint {
  text-align: center;
  color: rgba(255, 255, 255, 0.95);
  font-size: clamp(0.85rem, 1.8vw + 0.1rem, 1.05rem);
  margin: clamp(0.4em, 1vh, 0.6em) 0;
  min-height: 1.2em;
  line-height: 1.4;
}

#handwriting-canvas {
  background: var(--canvas-bg);
  border: 3px solid var(--canvas-border);
  border-radius: clamp(10px, 2.5vw, 16px);

  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);

  margin: clamp(0.5em, 1.5vh, 0.8em) auto;

  touch-action: none;

  /* Responsive sizing while maintaining aspect ratio */
  width: 100%;
  max-width: min(640px, 88vw);
  aspect-ratio: 24 / 11;
  height: auto;

  display: block;

  cursor: crosshair;

  transition: all var(--transition-speed);
}

/* Canvas interaction states */
#handwriting-canvas.drawing {
  border-color: var(--canvas-border-active);
  box-shadow: 0 0 20px rgba(255, 107, 53, 0.5),
    0 4px 20px rgba(0, 0, 0, 0.15);
}

#handwriting-canvas.processing {
  border-color: var(--canvas-border-processing);
  box-shadow: 0 0 25px rgba(33, 150, 243, 0.7),
    0 4px 20px rgba(0, 0, 0, 0.15);
}

/* ========================================
   CONTROL BUTTONS
   ======================================== */

#clear-canvas {
  background: #fff;
  color: var(--primary-color);
  border: 2px solid var(--primary-color);

  font-family: inherit;
  font-size: clamp(1rem, 2.2vw + 0.2rem, 1.2rem);
  font-weight: bold;

  border-radius: clamp(10px, 2.5vw, 16px);
  padding: clamp(0.4em, 1.5vh, 0.6em) clamp(1em, 3vw, 1.8em);

  margin: clamp(0.5em, 1.5vh, 0.8em) auto;

  cursor: pointer;
  transition: all 0.25s ease;

  min-height: 44px;
  display: block;
}

#clear-canvas:hover {
  background: var(--primary-color);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 78, 80, 0.3);
}

#clear-canvas:active {
  transform: translateY(0);
}

#submit-answer {
  background: var(--secondary-color);
  color: #fff;
  border: none;

  font-family: inherit;
  font-size: clamp(1.1rem, 2.5vw + 0.3rem, 1.5rem);
  font-weight: bold;

  border-radius: clamp(12px, 3vw, 20px);
  padding: clamp(0.6em, 2vh, 0.85em) clamp(1.5em, 4vw, 2.5em);

  margin-top: clamp(0.8em, 2vh, 1.2em);

  box-shadow: 0 6px 24px rgba(76, 175, 80, 0.3);

  cursor: pointer;
  transition: all 0.25s ease;

  min-height: 48px;
}

#submit-answer:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(76, 175, 80, 0.4);
}

#submit-answer:active {
  transform: translateY(0);
}

/* ========================================
   FEEDBACK DISPLAY
   ======================================== */

#feedback {
  font-size: clamp(1.3rem, 3vw + 0.3rem, 2rem);
  margin-top: clamp(0.6em, 2vh, 1em);
  min-height: clamp(1.5em, 3vh, 2em);

  color: #fff;
  text-shadow: 2px 2px 8px rgba(255, 78, 80, 0.5);
  text-align: center;
  font-weight: bold;

  transition: all var(--transition-speed);
}

/* ========================================
   GAME OVER SCREEN
   ======================================== */

#game-over {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--button-bg) 100%);
  z-index: 10;
}

#final-score {
  font-size: clamp(1.6rem, 4vw + 0.4rem, 2.5rem);
  color: #fff;
  margin: clamp(0.6em, 2vh, 1em) 0;
  text-align: center;
  text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
}

/* ========================================
   LOADING SPINNER
   ======================================== */

.spinner {
  border: clamp(5px, 1.5vw, 8px) solid rgba(255, 255, 255, 0.3);
  border-top: clamp(5px, 1.5vw, 8px) solid var(--primary-color);
  border-radius: 50%;

  width: clamp(50px, 12vw, 70px);
  height: clamp(50px, 12vw, 70px);

  animation: spin 1s linear infinite;

  margin: clamp(1em, 3vh, 2em) auto;
  display: block;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

/* ========================================
   PREDICTION MODAL
   ======================================== */

#predict-modal .modal-content {
  text-align: center;
}

#predict-result h3 {
  color: var(--primary-color);
  margin-bottom: 0.6em;
}

#predicted-digit {
  font-family: 'Fredoka One', 'Comic Sans MS', cursive, sans-serif;
  font-size: clamp(2rem, 5vw + 0.5rem, 3.5rem);
  color: var(--secondary-color);
  text-shadow: 3px 3px 12px rgba(10, 207, 254, 0.4);
  margin: clamp(0.4em, 2vh, 0.7em) 0;
}

/* ========================================
   DEVICE-SPECIFIC RESPONSIVE ADJUSTMENTS
   ======================================== */

/* Mobile Portrait (< 600px width) */
@media (max-width: 599px) and (orientation: portrait) {
  :root {
    --content-scale: var(--content-scale-portrait);
  }

  body {
    padding: var(--margin-mobile-portrait);
    padding-top: calc(var(--margin-mobile-portrait) + var(--safe-area-top));
    padding-bottom: calc(var(--margin-mobile-portrait) + var(--safe-area-bottom));
    padding-left: calc(var(--margin-mobile-portrait) + var(--safe-area-left));
    padding-right: calc(var(--margin-mobile-portrait) + var(--safe-area-right));
  }

  .screen {
    padding: var(--padding-mobile);
  }

  h1 {
    font-size: clamp(1.5rem, 6vw, 2.2rem);
  }

  h2 {
    font-size: clamp(1.2rem, 5vw, 1.7rem);
  }

  h3 {
    font-size: clamp(1rem, 4.5vw, 1.4rem);
  }

  .game-header {
    font-size: clamp(0.85rem, 3.5vw, 1.1rem);
    gap: 0.3em;
  }

  .modal-content {
    max-width: 92vw;
    padding: 1.3em 1.5em;
  }
}

/* Mobile Landscape (< 900px width, landscape) */
@media (max-width: 899px) and (orientation: landscape) {
  :root {
    --content-scale: var(--content-scale-landscape);
  }

  body {
    padding: var(--margin-mobile-landscape);
    padding-top: calc(var(--margin-mobile-landscape) + var(--safe-area-top));
    padding-bottom: calc(var(--margin-mobile-landscape) + var(--safe-area-bottom));
    padding-left: calc(var(--margin-mobile-landscape) + var(--safe-area-left));
    padding-right: calc(var(--margin-mobile-landscape) + var(--safe-area-right));
  }


  /* Force game screen alignment and tight padding */
  #game-screen.screen {
    justify-content: flex-start !important;
    padding: 4px 16px !important;
  }

  /* Hide non-essential elements in landscape to save vertical space */
  #model-status,
  .hint {
    display: none !important;
  }

  #problem,
  .problem-large {
    font-size: clamp(1.2rem, 3.5vh, 1.8rem);
    margin-bottom: 2px !important;
    line-height: 1.1;
  }

  #problem-area {
    gap: 2px !important;
    margin-top: 0 !important;
  }

  .canvas-panel {
    padding: 4px 8px !important;
    max-width: min(450px, 70vw);
  }

  .panel-title {
    font-size: 0.8rem;
    margin: 2px 0 4px 0 !important;
  }

  #handwriting-canvas {
    margin: 2px auto !important;
    max-width: min(420px, 65vw);
    max-height: 45vh !important;
    height: 45vh !important;
    aspect-ratio: auto !important;
  }

  #clear-canvas {
    font-size: 0.85rem;
    padding: 2px 12px;
    margin: 2px auto !important;
    min-height: 30px;
  }

  .big-btn {
    padding: 4px 12px;
    margin-top: 4px;
  }
}

/* Tablet Portrait (600px - 900px, portrait) */
@media (min-width: 600px) and (max-width: 899px) and (orientation: portrait) {
  body {
    padding: var(--margin-tablet-portrait);
    padding-top: calc(var(--margin-tablet-portrait) + var(--safe-area-top));
    padding-bottom: calc(var(--margin-tablet-portrait) + var(--safe-area-bottom));
    padding-left: calc(var(--margin-tablet-portrait) + var(--safe-area-left));
    padding-right: calc(var(--margin-tablet-portrait) + var(--safe-area-right));
  }

  .screen {
    padding: var(--padding-tablet);
  }
}

/* Tablet Landscape (900px - 1200px, landscape) */
@media (min-width: 900px) and (max-width: 1199px) and (orientation: landscape) {
  body {
    padding: var(--margin-tablet-landscape);
    padding-top: calc(var(--margin-tablet-landscape) + var(--safe-area-top));
    padding-bottom: calc(var(--margin-tablet-landscape) + var(--safe-area-bottom));
    padding-left: calc(var(--margin-tablet-landscape) + var(--safe-area-left));
    padding-right: calc(var(--margin-tablet-landscape) + var(--safe-area-right));
  }

  .screen {
    padding: var(--padding-tablet);
  }
}

/* Desktop & Large Screens (> 1200px) */
@media (min-width: 1200px) {
  body {
    padding: var(--margin-desktop);
    padding-top: calc(var(--margin-desktop) + var(--safe-area-top));
    padding-bottom: calc(var(--margin-desktop) + var(--safe-area-bottom));
    padding-left: calc(var(--margin-desktop) + var(--safe-area-left));
    padding-right: calc(var(--margin-desktop) + var(--safe-area-right));
  }

  .screen {
    padding: var(--padding-desktop);
  }

  /* Max content width for very large screens */
  #app {
    max-width: 1600px;
    margin: 0 auto;
  }
}

/* Extra Small Devices (< 360px) */
@media (max-width: 359px) {
  body {
    padding: clamp(8px, 2vw, 12px);
  }

  .screen {
    padding: clamp(6px, 1.5vw, 10px);
  }

  h1 {
    font-size: clamp(1.3rem, 7vw, 1.8rem);
  }

  .big-btn,
  .mode-btn,
  .difficulty-btn {
    font-size: clamp(0.85rem, 4vw, 1rem);
    padding: 0.5em 1em;
  }
}

/* Short Screens (height < 600px) - Catches ALL phones in landscape */
@media (max-height: 600px) {
  body {
    padding-top: clamp(4px, 1vh, 8px);
    padding-bottom: clamp(4px, 1vh, 8px);
  }

  /* Force top alignment and reduced padding */
  .screen,
  #game-screen.screen {
    justify-content: flex-start !important;
    padding: 4px 16px !important;
    padding-top: clamp(4px, 1vh, 8px) !important;
  }

  h1 {
    font-size: clamp(1.2rem, 3.5vh, 1.8rem);
  }

  h2 {
    font-size: clamp(1rem, 3vh, 1.4rem);
  }

  h3 {
    font-size: clamp(0.9rem, 2.5vh, 1.2rem);
  }

  .game-header {
    margin-bottom: 0.2em;
    font-size: 0.9rem;
  }

  /* Hide non-essential elements */
  #model-status,
  .hint {
    display: none !important;
  }

  #problem,
  .problem-large {
    margin-bottom: 2px !important;
    font-size: clamp(1.4rem, 4vh, 2rem) !important;
    line-height: 1.1;
  }

  #problem-area {
    gap: 2px !important;
    margin-top: 0 !important;
  }

  .canvas-panel {
    padding: 4px 8px !important;
    max-width: min(500px, 80vw);
  }

  /* Force small canvas */
  #handwriting-canvas {
    margin: 2px auto !important;
    max-width: min(450px, 70vw);
    max-height: 45vh !important;
    height: 45vh !important;
    aspect-ratio: auto !important;
  }

  #clear-canvas {
    font-size: 0.85rem;
    padding: 2px 12px;
    margin: 2px auto !important;
    min-height: 28px;
  }

  .big-btn {
    margin-top: 0.4em;
    padding: 0.4em 1.2em;
  }
}

/* ========================================
   PRINT STYLES (if needed)
   ======================================== */

@media print {
  body {
    background: white;
    padding: 20mm;
  }

  .screen {
    position: relative;
  }

  .hidden {
    display: none !important;
  }
}