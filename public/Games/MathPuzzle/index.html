<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Math Puzzle - Educational Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>
<body>
    <div id="three-container"></div>
    
    <!-- Main Menu Page -->
    <div class="page main-container" id="mainMenu">
        <div class="title-container">
            <h1 class="main-title">
                <div class="title-line">
                    <span class="title-word">Math</span>
                </div>
                <div class="title-line">
                    <span class="title-word">Puzzle!</span>
                </div>
            </h1>
        </div>
        
        <div class="buttons-container">
            <button class="game-button primary-button" id="singlePlayer">
                <span class="button-text">Single Player Mode</span>
                <div class="button-glow"></div>
            </button>
            
            <button class="game-button settings-button" id="settings">
                <span class="button-text">Settings</span>
                <div class="button-glow"></div>
            </button>
        </div>
    </div>

    <!-- Difficulty Selection Page -->
    <div class="page difficulty-page" id="difficultyPage" style="display: none;">
        <div class="page-header">
            <button class="back-button" id="backToMain">
                <span>‚Üê Back</span>
            </button>
            <h2 class="page-title">Choose Your Level!</h2>
        </div>
        
        <div class="difficulty-container">
            <div class="difficulty-grid">
                <button class="difficulty-button easy-level" data-difficulty="easy">
                    <div class="difficulty-icon">üåü</div>
                    <div class="difficulty-name">Easy</div>
                    <div class="difficulty-description">Perfect for beginners!</div>
                </button>
                
                <button class="difficulty-button medium-level" data-difficulty="medium">
                    <div class="difficulty-icon">‚ö°</div>
                    <div class="difficulty-name">Medium</div>
                    <div class="difficulty-description">Ready for a challenge?</div>
                </button>
                
                <button class="difficulty-button hard-level" data-difficulty="hard">
                    <div class="difficulty-icon">üî•</div>
                    <div class="difficulty-name">Hard</div>
                    <div class="difficulty-description">Think you can handle it?</div>
                </button>
                
                <button class="difficulty-button extreme-level" data-difficulty="extreme">
                    <div class="difficulty-icon">üíÄ</div>
                    <div class="difficulty-name">Extreme</div>
                    <div class="difficulty-description">Only for math masters!</div>
                </button>
            </div>
            
            <div class="start-container">
                <button class="start-button" id="startGame" style="display: none;">
                    <span class="start-text">START GAME!</span>
                    <div class="start-glow"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div class="page settings-page" id="settingsPage" style="display: none;">
        <div class="page-header">
            <button class="back-button" id="backToMainFromSettings">
                <span>‚Üê Back</span>
            </button>
            <h2 class="page-title">Settings</h2>
        </div>
        
        <div class="settings-container">
            <div class="settings-section">
                <h3 class="settings-section-title">‚è±Ô∏è Timer Settings</h3>
                <div class="settings-item">
                    <label for="customTimeLimit" class="settings-label">
                        Custom Time Limit (seconds)
                    </label>
                    <div class="settings-input-group">
                        <input 
                            type="range" 
                            id="customTimeLimit" 
                            class="settings-slider" 
                            min="10" 
                            max="300" 
                            value="60" 
                            step="5"
                        >
                        <div class="settings-value-display">
                            <span id="timeLimitValue">60</span> seconds
                        </div>
                    </div>
                    <div class="settings-presets">
                        <button class="preset-button" data-time="30">30s</button>
                        <button class="preset-button" data-time="60">60s</button>
                        <button class="preset-button" data-time="90">90s</button>
                        <button class="preset-button" data-time="120">120s</button>
                        <button class="preset-button" data-time="180">180s</button>
                    </div>
                    <p class="settings-description">
                        Set a custom time limit for all difficulty levels. This will override the default difficulty timers.
                    </p>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">üéÆ Game Settings</h3>
                <div class="settings-item">
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="enableHints" class="settings-checkbox" checked>
                        <span>Enable Hint Button</span>
                    </label>
                </div>
                <div class="settings-item">
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="enableSkip" class="settings-checkbox" checked>
                        <span>Enable Skip Button</span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">üíæ Save Settings</h3>
                <div class="settings-actions">
                    <button class="settings-save-button" id="saveSettings">
                        <span>üíæ Save Settings</span>
                    </button>
                    <button class="settings-reset-button" id="resetSettings">
                        <span>üîÑ Reset to Defaults</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Countdown Page -->
    <div class="page countdown-page" id="countdownPage" style="display: none;">
        <div class="countdown-container">
            <div class="countdown-number" id="countdownNumber">3</div>
            <div class="countdown-message" id="countdownMessage">Get Ready!</div>
        </div>
    </div>

    <!-- Gameplay Page -->
    <div class="page gameplay-page" id="gameplayPage" style="display: none;">
        <!-- Game Header -->
        <div class="game-header">
            <div class="game-info">
                <div class="score-display">Score: <span id="currentScore">0</span></div>
                <div class="timer-display">Time: <span id="timeRemaining">60</span>s</div>
            </div>
        </div>

        <!-- Equation Display Area -->
        <div class="equation-container">
            <div class="equation-display" id="equationDisplay">
                <!-- Placeholder boxes will be dynamically generated -->
                <div class="equation-slot" data-position="0"></div>
                <div class="equation-operator">+</div>
                <div class="equation-slot" data-position="1"></div>
                <div class="equation-operator">=</div>
                <div class="equation-slot" data-position="2"></div>
            </div>
        </div>

        <!-- Combined Blocks Area -->
        <div class="answer-blocks-container">
            <h3 class="instruction-text">Drag the numbers and symbols to complete the equation!</h3>
            <div class="answer-blocks">
                <!-- Numbers Section -->
                <div class="blocks-section">
                    <div class="blocks-label">Numbers</div>
                    <div class="blocks-group" id="answerBlocks">
                        <!-- Draggable number blocks will be dynamically generated -->
                    </div>
                </div>
                
                <!-- Operations Section -->
                <div class="blocks-section">
                    <div class="blocks-label">Symbols</div>
                    <div class="blocks-group" id="operationBlocks">
                        <!-- Draggable operation blocks will be dynamically generated -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Controls -->
        <div class="game-controls">
            <button class="control-button undo-button" id="undoMove">‚Ü∂ Undo</button>
            <button class="control-button clear-button" id="clearEquation">Clear All</button>
            <button class="control-button hint-button" id="getHint">Hint</button>
            <button class="control-button skip-button" id="skipQuestion">Skip</button>
        </div>

        <!-- Success/Feedback Messages -->
        <div class="feedback-overlay" id="feedbackOverlay" style="display: none;">
            <div class="feedback-content">
                <div class="feedback-icon" id="feedbackIcon">üéâ</div>
                <div class="feedback-message" id="feedbackMessage">Correct! Well done!</div>
                <div class="feedback-actions" id="feedbackActions" style="display: none;">
                    <button class="control-button primary-button" id="playAgainBtn">üîÑ Play Again</button>
                    <button class="control-button secondary-button" id="mainMenuBtn">üè† Main Menu</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="particle-overlay"></div>
    
    <!-- Load scripts sequentially to avoid CORS issues with modules on file:// protocol -->
    <script src="js/utils/DeviceDetector.js"></script>
    <script src="js/utils/PerformanceMonitor.js"></script>
    <script src="js/utils/MathGenerator.js"></script>
    <script src="js/effects/ThreeJsBackground.js"></script>
    <script src="js/effects/AnimationController.js"></script>
    <script src="js/controllers/MathGameController.js"></script>
    <script src="js/controllers/GameController.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
