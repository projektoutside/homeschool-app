<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Comprehensive viewport for all devices including iOS Safari, Android, tablets -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <!-- iOS specific meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <!-- Theme color for browser chrome -->
  <meta name="theme-color" content="#000000">
  <meta name="msapplication-navbutton-color" content="#000000">
  <!-- Prevent telephone number detection on iOS -->
  <meta name="format-detection" content="telephone=no">
  <title>WriteMath! - Fun Math Game</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
</head>
<body>
  <div id="main-menu" class="screen">
    <h1 class="main-title">
      <span class="title-word title-word--write">Write</span>
      <span class="title-word title-word--math">Math!</span>
    </h1>
    <div class="menu-primary">
      <button id="single-mode-btn" class="big-btn">Single Player Mode</button>
      <button id="vs-mode-btn" class="big-btn">Two Player VS Mode</button>
    </div>
    <button id="settings-btn" class="settings-btn">‚öôÔ∏è Settings</button>
  </div>

  <div id="setup-screen" class="screen hidden">
    <h2 class="setup-title">Choose Math Type</h2>
    <div class="setup-panel">
      <div class="setup-section">
        <h3>Math Type</h3>
        <div class="game-modes">
          <div class="dropdown-wrapper">
            <select id="mode-select" title="Math Type">
              <option value="add">Addition</option>
              <option value="sub">Subtraction</option>
              <option value="mul">Multiplication</option>
              <option value="div">Division</option>
              <option value="random">Random</option>
            </select>
            <svg class="dropdown-arrow" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true"><path d="M5 8l5 5 5-5" stroke="#ff4e50" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
          </div>
        </div>
      </div>
      <div class="setup-section">
        <h3>Difficulty</h3>
        <div class="difficulty-select">
          <div class="dropdown-wrapper">
            <select id="difficulty-select" title="Difficulty">
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
            <svg class="dropdown-arrow" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true"><path d="M5 8l5 5 5-5" stroke="#ff4e50" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
          </div>
        </div>
      </div>
    </div>
    <button id="start-btn" class="big-btn start-btn">Start</button>
  </div>

  <div id="settings-modal" class="modal hidden">
    <div class="modal-content">
      <h2>Settings</h2>
      <label>Timer Length:
        <select id="timer-select">
          <option value="30">30 seconds</option>
          <option value="60" selected>60 seconds</option>
          <option value="120">120 seconds</option>
          <option value="180">3 minutes</option>
          <option value="240">4 minutes</option>
          <option value="300">5 minutes</option>
        </select>
      </label>
      <label>Background Music:
        <input type="checkbox" id="music-toggle">
      </label>
      <label>Music Volume:
        <input type="range" id="music-volume" min="0" max="100" value="20">
      </label>
      <button id="close-settings" class="big-btn">Close</button>
    </div>
  </div>

  <div id="game-screen" class="screen hidden">
    <div class="game-header">
      <div id="scoreboard">Score: <span id="score">0</span></div>
      <div id="timer">‚è±Ô∏è <span id="time-left">60</span>s</div>
    </div>
    <div id="model-status">
      Loading handwriting model...
    </div>
    <div id="problem-area">
      <div id="problem"></div>
      <div class="tabbed-canvas-container">
        <!-- Tab Buttons -->
        <div class="canvas-tabs">
          <button class="canvas-tab active" data-tab="answer" id="sp-tab-answer">Answer</button>
          <button class="canvas-tab" data-tab="work" id="sp-tab-work">Show Work</button>
        </div>
        <!-- Canvas Panels -->
        <div class="canvas-panels">
          <div class="canvas-panel active" id="sp-panel-answer">
            <canvas id="handwriting-canvas" width="480" height="220"></canvas>
            <div id="canvas-status">Draw your answer above</div>
            <!-- Spacer to match Clear button height in work panel for smooth switching -->
            <button class="work-clear-btn spacer" aria-hidden="true" style="visibility: hidden; pointer-events: none;">Clear Work</button>
          </div>
          <div class="canvas-panel" id="sp-panel-work">
            <canvas id="work-canvas" width="480" height="220"></canvas>
            <div class="work-canvas-status">Show your work here</div>
            <button id="work-clear-btn" class="work-clear-btn">Clear Work</button>
          </div>
        </div>
        <!-- Auto-clear toggle (below canvas) -->
        <div class="canvas-options">
          <label class="auto-clear-toggle-label">
            <input type="checkbox" id="auto-clear-toggle-game" class="auto-clear-checkbox" checked>
            <span class="auto-clear-text">Auto Clear Work on Correct</span>
          </label>
        </div>
      </div>
    </div>
    <div id="feedback"></div>
  </div>

  <!-- VS Mode Screen -->
  <div id="vs-screen" class="screen hidden">
    <div class="vs-header">
    </div>
    <div class="vs-board">
      <div class="player player-top" id="player2">
        <div class="player-result" id="p2-result" aria-live="polite"></div>
        <div class="player-confetti player-confetti-left" id="p2-confetti" aria-hidden="true"></div>
        <div class="player-hud">
          <div class="p-score">Score: <span id="p2-score">0</span></div>
          <div class="p-timer"><span id="p2-time-left">60</span>s</div>
          <div class="p-problem" id="p2-problem"></div>
        </div>
        <div class="player-canvas-container rotate180">
          <div class="player-tabbed-canvas">
            <div class="canvas-tabs">
              <button class="canvas-tab active" data-tab="answer" data-player="p2">Answer</button>
              <button class="canvas-tab" data-tab="work" data-player="p2">Work</button>
            </div>
            <div class="canvas-panels">
              <div class="canvas-panel active" id="p2-panel-answer">
                <canvas id="p2-canvas" width="480" height="220"></canvas>
                <div class="p-canvas-status" id="p2-canvas-status">Draw your answer</div>
                <!-- Spacer -->
                <button class="p-work-clear-btn spacer" aria-hidden="true" style="visibility: hidden; pointer-events: none;">Clear</button>
              </div>
              <div class="canvas-panel" id="p2-panel-work">
                <canvas id="p2-work-canvas" width="480" height="220"></canvas>
                <div class="p-work-canvas-status">Show your work</div>
                <button id="p2-work-clear-btn" class="p-work-clear-btn">Clear</button>
              </div>
            </div>
          </div>
          <div class="p-feedback" id="p2-feedback"></div>
        </div>
      </div>
      <div class="center-divider">
        <div class="vs-label">VS</div>
        <label class="vs-auto-clear-toggle">
          <input type="checkbox" id="auto-clear-toggle-vs" class="auto-clear-checkbox" checked>
          <span class="auto-clear-text-vs">Auto Clear Work</span>
        </label>
      </div>
      <div class="player player-bottom" id="player1">
        <div class="player-result" id="p1-result" aria-live="polite"></div>
        <div class="player-confetti player-confetti-right" id="p1-confetti" aria-hidden="true"></div>
        <div class="player-hud">
          <div class="p-score">Score: <span id="p1-score">0</span></div>
          <div class="p-timer"><span id="p1-time-left">60</span>s</div>
          <div class="p-problem" id="p1-problem"></div>
        </div>
        <div class="player-canvas-container">
          <div class="player-tabbed-canvas">
            <div class="canvas-tabs">
              <button class="canvas-tab active" data-tab="answer" data-player="p1">Answer</button>
              <button class="canvas-tab" data-tab="work" data-player="p1">Work</button>
            </div>
            <div class="canvas-panels">
              <div class="canvas-panel active" id="p1-panel-answer">
                <canvas id="p1-canvas" width="480" height="220"></canvas>
                <div class="p-canvas-status" id="p1-canvas-status">Draw your answer</div>
                <!-- Spacer -->
                <button class="p-work-clear-btn spacer" aria-hidden="true" style="visibility: hidden; pointer-events: none;">Clear</button>
              </div>
              <div class="canvas-panel" id="p1-panel-work">
                <canvas id="p1-work-canvas" width="480" height="220"></canvas>
                <div class="p-work-canvas-status">Show your work</div>
                <button id="p1-work-clear-btn" class="p-work-clear-btn">Clear</button>
              </div>
            </div>
          </div>
          <div class="p-feedback" id="p1-feedback"></div>
        </div>
      </div>
    </div>
    <div class="vs-footer">
      <button id="vs-exit" class="big-btn">Exit</button>
    </div>
  </div>

  <!-- Prediction Modal -->
  <div id="predict-modal" class="modal hidden">
    <div class="modal-content">
      <div id="predict-spinner" class="spinner hidden"></div>
      <div id="predict-result" class="hidden">
        <h3>Is this your answer?</h3>
        <div id="predicted-digit"></div>
        <button id="confirm-predict-yes" class="big-btn">Yes</button>
        <button id="confirm-predict-no" class="big-btn">No</button>
      </div>
    </div>
  </div>

  <div id="game-over" class="screen hidden">
    <h2>Game Over!</h2>
    <div id="final-score"></div>
    <button id="restart-btn" class="big-btn">Restart</button>
    <button id="menu-btn" class="big-btn">Main Menu</button>
  </div>

  <div id="countdown-overlay" class="countdown-overlay hidden" aria-hidden="true">3</div>
  <div id="vs-winner-overlay" class="vs-winner-overlay hidden" aria-live="polite">
    <!-- Player 2 Section (Top) -->
    <div class="vs-result-section section-top" id="vs-result-p2">
      <div class="result-content rotate-content">
        <div class="result-icon" id="p2-result-icon">üëë</div>
        <h2 class="result-title" id="p2-result-title">WINNER!</h2>
        <div class="result-message" id="p2-result-message">Great job!</div>
        <div class="result-score" id="p2-final-score">Score: 0</div>
      </div>
      <div class="vs-confetti-container" id="p2-confetti-area"></div>
    </div>

    <!-- Player 1 Section (Bottom) -->
    <div class="vs-result-section section-bottom" id="vs-result-p1">
      <div class="result-content">
        <div class="result-icon" id="p1-result-icon">üëë</div>
        <h2 class="result-title" id="p1-result-title">WINNER!</h2>
        <div class="result-message" id="p1-result-message">Great job!</div>
        <div class="result-score" id="p1-final-score">Score: 0</div>
      </div>
      <div class="vs-confetti-container" id="p1-confetti-area"></div>
    </div>
  </div>

  <!-- Audio tags -->
  <audio id="menu-music" src="Music/MainMenu.mp3" preload="auto" loop></audio>
  <audio id="bg-music" preload="auto"></audio>
  
  <!-- Development Testing Panel (remove in production) -->
  <div id="dev-panel">
    <strong>Dev Testing</strong><br>
    <button onclick="testHandwriting()">Test Recognition</button><br>
    <button onclick="testDigitPatterns()">Pattern Analysis</button><br>
    <button onclick="showRecognitionDebug()">Visual Debug</button><br>
    <small>Open console for results</small>
  </div>
  
  <script>
    // Show dev panel if in development mode
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      const devPanel = document.getElementById('dev-panel');
      if (devPanel) devPanel.classList.add('visible');
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <!-- Tesseract.js disabled - using CNN + Pattern recognition -->
  <!-- Visual libraries -->
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <!-- Three.js temporarily disabled to force neon fallback -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script> -->

  <!-- Viewport management (load first for responsive setup) -->
  <script src="viewport.js"></script>
  <script src="handwriting.js"></script>
  <script src="visuals.js"></script>
  <script src="main.js"></script>
</body>
</html> 