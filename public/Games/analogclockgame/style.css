/* =============================================
   ANALOG CLOCK GAME - RESPONSIVE VISUAL SYSTEM
   Complete visual layer rework for cross-platform compatibility
   ============================================= */

/* =============================================
   1. CSS CUSTOM PROPERTIES & DESIGN TOKENS
   ============================================= */
:root {
    /* === Color Palette - Balanced & Fun === */
    --color-primary: #7C4DFF;
    /* Vibrant Purple */
    --color-primary-dark: #651FFF;
    --color-secondary: #4ECDC4;
    /* Teal/Mint */
    --color-secondary-dark: #3DBDB5;
    --color-accent: #FFE66D;
    /* Sunny Yellow */
    --color-accent-dark: #F5D84D;
    --color-success: #69F0AE;
    /* Bright Green */
    --color-warning: #FFB74D;
    /* Warm Orange */
    --color-fun: #FF6EB4;
    /* Playful Pink */

    --color-text-main: #FFFFFF;
    --color-text-muted: rgba(255, 255, 255, 0.75);
    --color-text-dim: rgba(255, 255, 255, 0.5);

    --color-bg-dark: #1A1A2E;
    --color-bg-mid: #16213E;
    --color-bg-light: #0F3460;

    /* === Gradients - More Colorful & Fun === */
    --bg-gradient: linear-gradient(135deg, #1A1A2E 0%, #2D1B4E 50%, #0F3460 100%);
    --card-gradient: linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.04));
    --btn-primary-gradient: linear-gradient(135deg, #7C4DFF 0%, #B388FF 100%);
    --btn-secondary-gradient: linear-gradient(135deg, var(--color-secondary) 0%, #80DEEA 100%);

    /* === Glassmorphism === */
    --glass-bg: rgba(255, 255, 255, 0.08);
    --glass-bg-hover: rgba(255, 255, 255, 0.15);
    --glass-border: 1px solid rgba(255, 255, 255, 0.12);
    --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    --backdrop-blur: 12px;

    /* === Fluid Typography (clamp-based) === */
    --text-xs: clamp(0.7rem, 1.5vw, 0.8rem);
    --text-sm: clamp(0.8rem, 1.8vw, 0.9rem);
    --text-base: clamp(0.9rem, 2vw, 1rem);
    --text-md: clamp(1rem, 2.2vw, 1.15rem);
    --text-lg: clamp(1.1rem, 2.5vw, 1.35rem);
    --text-xl: clamp(1.3rem, 3vw, 1.75rem);
    --text-2xl: clamp(1.5rem, 4vw, 2.25rem);
    --text-3xl: clamp(1.8rem, 5vw, 3rem);

    /* === Adaptive Spacing === */
    --space-2xs: clamp(0.15rem, 0.5vw, 0.25rem);
    --space-xs: clamp(0.25rem, 0.8vw, 0.4rem);
    --space-sm: clamp(0.4rem, 1vw, 0.6rem);
    --space-md: clamp(0.6rem, 1.5vw, 1rem);
    --space-lg: clamp(0.8rem, 2vw, 1.25rem);
    --space-xl: clamp(1rem, 2.5vw, 1.5rem);
    --space-2xl: clamp(1.25rem, 3vw, 2rem);

    /* === Border Radius === */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;
    --radius-round: 50%;
    --radius-pill: 9999px;

    /* === Safe Areas (Notch/Home Bar) === */
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);

    /* === Layout === */
    --header-height: 56px;
    --max-content-width: 1400px;
    --min-touch-target: 44px;

    /* === Transitions === */
    --transition-fast: 150ms ease-out;
    --transition-base: 250ms ease-out;
    --transition-slow: 400ms ease-out;
    --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* =============================================
   2. CSS RESET & BASE STYLES
   ============================================= */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    scroll-behavior: smooth;
}

html,
body {
    width: 100%;
    height: 100%;
    height: 100dvh;
    /* Dynamic viewport height for mobile */
    overflow: hidden;
    font-family: 'Outfit', 'Segoe UI', system-ui, -apple-system, sans-serif;
    font-size: 16px;
    line-height: 1.5;
    color: var(--color-text-main);
    background: var(--bg-gradient);
    background-attachment: fixed;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: var(--safe-left) var(--safe-right) var(--safe-bottom);
    background-size: 200% 200%;
    animation: gradientShift 20s ease infinite;
}

@keyframes gradientShift {

    0%,
    100% {
        background-position: 0% 50%;
    }

    50% {
        background-position: 100% 50%;
    }
}

/* =============================================
   3. UTILITY CLASSES
   ============================================= */
.hidden {
    display: none !important;
}

.visible {
    display: flex !important;
}

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Animation Classes */
@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {

    0%,
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(124, 77, 255, 0.5);
    }

    50% {
        transform: scale(1.02);
        box-shadow: 0 0 0 8px rgba(124, 77, 255, 0);
    }
}

@keyframes shake {

    0%,
    100% {
        transform: translateX(0);
    }

    20%,
    60% {
        transform: translateX(-5px);
    }

    40%,
    80% {
        transform: translateX(5px);
    }
}

.pulse-animation {
    animation: pulse 2s ease-in-out infinite;
}

/* =============================================
   4. GAME HEADER BAR
   ============================================= */
#game-header-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;

    display: flex;
    align-items: center;
    justify-content: space-between;

    height: calc(var(--header-height) + var(--safe-top));
    padding-top: var(--safe-top);
    padding-left: calc(var(--space-md) + var(--safe-left));
    padding-right: calc(var(--space-md) + var(--safe-right));

    background: rgba(26, 26, 46, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
}

.header-left,
.header-center,
.header-right {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.header-left,
.header-right {
    flex: 0 0 auto;
}

.header-center {
    flex: 1;
    justify-content: center;
}

.header-icon-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--min-touch-target);
    height: var(--min-touch-target);
    border: none;
    border-radius: var(--radius-round);
    background: var(--btn-secondary-gradient);
    color: var(--color-text-main);
    font-size: var(--text-lg);
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    touch-action: manipulation;
}

.header-icon-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.header-icon-btn:active {
    transform: scale(0.95);
}

.mini-score {
    font-size: var(--text-md);
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.coin-display-mini {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    background: var(--glass-bg);
    border-radius: var(--radius-pill);
    font-size: var(--text-sm);
    font-weight: 600;
}

/* =============================================
   5. MAIN GAME CONTAINER LAYOUT
   ============================================= */
#game-container {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: var(--max-content-width);
    margin: 0 auto;

    /* Two-column grid on desktop */
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr;
    gap: var(--space-xl);
    align-items: center;

    /* Account for header */
    padding: calc(var(--header-height) + var(--safe-top) + var(--space-md)) var(--space-lg) var(--space-lg);

    opacity: 0;
    animation: fadeIn 0.4s ease-out forwards;
}

#game-container.visible {
    opacity: 1;
}

/* =============================================
   6. CLOCK PANEL
   ============================================= */
#clock-panel {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    position: relative;
}

.clock-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    position: relative;
}

.clock-container {
    /* Responsive clock sizing - uses minimum of multiple constraints */
    width: min(90%, 45vh, 450px);
    aspect-ratio: 1;
    filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.35));
    transition: transform var(--transition-base);
}

.clock-container:hover {
    transform: scale(1.02);
}

#analog-clock {
    width: 100%;
    height: 100%;
    display: block;
}

.clock-status {
    margin-top: var(--space-sm);
    font-size: var(--text-md);
    font-weight: 600;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    min-height: 1.2em;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

#ampm-panel {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color-bg-dark);
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-pill);
    font-weight: 600;
    font-size: var(--text-sm);
    border: var(--glass-border);
}

.points-popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: var(--text-3xl);
    font-weight: 800;
    color: var(--color-accent);
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.4s, transform 0.4s;
    z-index: 10;
}

.points-popup.show {
    opacity: 1;
    transform: translate(-50%, -80%);
}

/* =============================================
   7. GAME PANEL (Stats + Options)
   ============================================= */
#game-panel {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: var(--space-lg);
    width: 100%;
    height: 100%;
    max-width: 550px;
    margin: 0 auto;
}

/* Progress Panel */
#progress-panel {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    padding: var(--space-md);
    background: var(--glass-bg);
    backdrop-filter: blur(var(--backdrop-blur));
    -webkit-backdrop-filter: blur(var(--backdrop-blur));
    border: var(--glass-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--glass-shadow);
}

.level-row {
    display: flex;
    justify-content: center;
}

.badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-xs) var(--space-md);
    background: var(--btn-primary-gradient);
    border-radius: var(--radius-pill);
    font-size: var(--text-sm);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-sm);
    text-align: center;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2xs);
}

.stat-label {
    font-size: var(--text-xs);
    text-transform: uppercase;
    color: var(--color-text-muted);
    letter-spacing: 0.5px;
}

#stars,
#timer,
#points {
    font-size: var(--text-lg);
    font-weight: 700;
    font-variant-numeric: tabular-nums;
}

#timer {
    color: var(--color-secondary);
}

#stars {
    color: var(--color-accent);
}

#points {
    color: var(--color-primary);
}

/* Question Panel */
#question-panel {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: var(--space-lg);
    flex: 1;
    min-height: 0;
}

#question-panel h1 {
    font-size: var(--text-2xl);
    font-weight: 700;
    text-align: center;
    line-height: 1.3;
}

/* Options Grid */
#options {
    display: grid;
    grid-template-columns: repeat(2, 1fr) !important;
    grid-template-rows: repeat(2, 1fr);
    gap: var(--space-sm);
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
}

/* Base option styling - elegant glassmorphism with unified teal color */
.option {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 48px;
    padding: var(--space-sm) var(--space-md);
    aspect-ratio: 2 / 1;
    border-radius: var(--radius-md);
    font-size: var(--text-lg);
    font-weight: 700;
    color: #FFFFFF;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
    cursor: pointer;
    user-select: none;
    touch-action: manipulation;
    transition: all var(--transition-fast);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);

    /* Elegant teal/mint - complements the dark blue-purple background */
    background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(64, 224, 208, 0.1));
    border: 2px solid rgba(78, 205, 196, 0.5);
    box-shadow: 0 4px 12px rgba(78, 205, 196, 0.15);
}

.option:hover,
.option:focus {
    background: linear-gradient(135deg, rgba(78, 205, 196, 0.4), rgba(64, 224, 208, 0.25));
    border-color: #4ECDC4;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(78, 205, 196, 0.3);
}

/* Active state for all options */
.option:active {
    transform: translateY(0) scale(0.97);
    background: rgba(78, 205, 196, 0.15);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

/* =============================================
   8. REWARD SHOP PANEL (Overlay Style)
   ============================================= */
#reward-shop-panel.hidden-panel {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 2000;
}

#shop-items-container.overlay-style {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 2001;

    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: var(--space-md);
    align-content: start;

    padding: calc(var(--header-height) + var(--safe-top) + var(--space-lg)) var(--space-lg) calc(var(--space-lg) + var(--safe-bottom));

    background: #1A1A2E;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);

    overflow-y: auto;
    overscroll-behavior: contain;

    transform: translateY(-100%);
    opacity: 0;
    pointer-events: none;
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.35s;
}

#shop-items-container.overlay-style[aria-hidden="false"] {
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
}

.shop-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);

    min-height: 120px;
    padding: var(--space-md);

    background: var(--glass-bg);
    border: var(--glass-border);
    border-radius: var(--radius-lg);

    cursor: pointer;
    touch-action: manipulation;
    transition: all var(--transition-fast);
}

.shop-item:hover {
    background: var(--glass-bg-hover);
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.shop-item:active {
    transform: scale(0.97);
}

.item-icon {
    font-size: 2rem;
}

.item-info {
    text-align: center;
}

.item-name {
    font-size: var(--text-base);
    font-weight: 600;
}

.item-description {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
}

.item-cost {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    background: rgba(0, 0, 0, 0.3);
    border-radius: var(--radius-pill);
    font-size: var(--text-sm);
    font-weight: 600;
}

.insufficient-funds {
    opacity: 0.4;
    filter: grayscale(1);
    cursor: not-allowed;
    pointer-events: none;
}

.shop-close-btn {
    grid-column: 1 / -1;
    /* Span full width in grid */
    width: 100%;
    margin-top: var(--space-md);
    padding: var(--space-md);
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    min-height: 50px;
    /* Ensure 44px+ touch target */
}

.shop-close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    border-color: rgba(255, 255, 255, 0.4);
}

.shop-close-btn:active {
    transform: translateY(0);
    background: rgba(255, 255, 255, 0.05);
}

#purchase-feedback {
    position: fixed;
    bottom: calc(var(--space-xl) + var(--safe-bottom));
    left: 50%;
    transform: translateX(-50%);
    padding: var(--space-sm) var(--space-lg);
    background: var(--color-secondary);
    border-radius: var(--radius-pill);
    font-weight: 600;
    z-index: 100;
}

/* =============================================
   9. MODAL SYSTEM (Universal)
   ============================================= */
.start-menu-overlay,
.game-over-modal,
.instructions-modal,
.settings-modal,
.level-transition-modal {
    position: fixed;
    inset: 0;
    z-index: 1500;

    display: none;
    justify-content: center;
    align-items: center;

    padding: var(--space-md);
    padding-top: calc(var(--space-md) + var(--safe-top));
    padding-bottom: calc(var(--space-md) + var(--safe-bottom));

    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

/* Show modals when not hidden */
.start-menu-overlay:not(.hidden),
.game-over-modal:not(.hidden),
.instructions-modal:not(.hidden),
.settings-modal:not(.hidden),
.level-transition-modal:not(.hidden) {
    display: flex;
}

.modal-content,
.start-menu-content {
    width: 100%;
    max-width: 480px;
    max-height: calc(100dvh - var(--space-2xl) - var(--safe-top) - var(--safe-bottom));

    padding: var(--space-xl);

    background: #1E1E32;
    background-image: linear-gradient(145deg, rgba(80, 80, 120, 0.15), rgba(40, 40, 60, 0.15));
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-xl);
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);

    overflow-y: auto;
    overscroll-behavior: contain;

    text-align: center;
    color: var(--color-text-main);

    animation: fadeInUp 0.3s ease-out;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
}

.modal-header h2 {
    font-size: var(--text-xl);
    font-weight: 700;
    flex: 1;
}

.modal-body {
    margin-bottom: var(--space-lg);
}

.modal-body p {
    margin-bottom: var(--space-sm);
    font-size: var(--text-base);
    line-height: 1.6;
}

.modal-footer {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

/* =============================================
   10. START MENU SPECIFIC
   ============================================= */
.game-header {
    margin-bottom: var(--space-lg);
}

.game-title {
    font-size: var(--text-3xl);
    font-weight: 800;
    margin-bottom: var(--space-xs);
    background: linear-gradient(135deg, #FFD166 0%, #B388FF 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
}

.game-tagline {
    font-size: var(--text-base);
    color: var(--color-text-muted);
    margin-bottom: var(--space-md);
}

.high-score-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-md);
    background: var(--glass-bg);
    border: var(--glass-border);
    border-radius: var(--radius-pill);
}

.trophy-icon {
    font-size: 1.5rem;
}

.score-info {
    display: flex;
    flex-direction: column;
    text-align: left;
}

.score-label {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
}

.score-number {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-accent);
}

/* Difficulty Selector */
.difficulty-selector {
    margin: var(--space-lg) 0;
}

.section-title {
    font-size: var(--text-md);
    font-weight: 600;
    margin-bottom: var(--space-md);
    color: var(--color-text-muted);
}

.difficulty-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-sm);
}

.difficulty-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-md);

    background: rgba(0, 0, 0, 0.25);
    border: 2px solid transparent;
    border-radius: var(--radius-md);

    cursor: pointer;
    transition: all var(--transition-fast);
}

.difficulty-card input {
    display: none;
}

.difficulty-card:hover,
.difficulty-card:has(input:checked) {
    background: rgba(124, 77, 255, 0.2);
    border-color: var(--color-primary);
    transform: translateY(-2px);
}

.card-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2xs);
}

.card-icon {
    font-size: 1.75rem;
}

.card-title {
    font-size: var(--text-base);
    font-weight: 700;
}

.card-subtitle {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
}

.card-description {
    font-size: var(--text-xs);
    color: var(--color-text-dim);
    margin-top: var(--space-2xs);
}

/* Menu Actions */
.menu-actions {
    margin-top: var(--space-lg);
}

.secondary-actions {
    display: flex;
    justify-content: center;
    gap: var(--space-sm);
    margin-top: var(--space-md);
    flex-wrap: wrap;
}

/* =============================================
   11. UNIFIED BUTTON STYLES
   ============================================= */
button {
    font-family: inherit;
    border: none;
    outline: none;
    cursor: pointer;
    touch-action: manipulation;
}

button:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
}

.primary-btn,
.start-button,
.primary-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);

    width: 100%;
    min-height: var(--min-touch-target);
    padding: var(--space-md) var(--space-xl);

    background: var(--btn-primary-gradient);
    border-radius: var(--radius-pill);

    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-text-main);

    box-shadow: 0 4px 15px rgba(124, 77, 255, 0.35);
    transition: all var(--transition-fast);
}

.primary-btn:hover,
.start-button:hover,
.primary-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(124, 77, 255, 0.45);
}

.primary-btn:active,
.start-button:active,
.primary-button:active {
    transform: translateY(0) scale(0.98);
}

.secondary-btn,
.secondary-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);

    min-height: var(--min-touch-target);
    padding: var(--space-sm) var(--space-lg);

    background: var(--glass-bg);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-pill);

    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text-main);

    transition: all var(--transition-fast);
}

.secondary-btn:hover,
.secondary-button:hover {
    background: var(--glass-bg-hover);
}

.secondary-btn:active,
.secondary-button:active {
    transform: scale(0.97);
}

.btn-text,
.btn-icon {
    display: inline;
}

/* =============================================
   12. SETTINGS MODAL SPECIFIC
   ============================================= */
.setting-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    margin-bottom: var(--space-md);
    text-align: left;
}

.setting-item label {
    font-size: var(--text-sm);
    font-weight: 500;
}

.setting-item input[type="range"] {
    width: 100%;
    height: 8px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-pill);
    outline: none;
}

.setting-item input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: var(--radius-round);
    background: var(--color-secondary);
    cursor: pointer;
}

.setting-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.settings-preview {
    padding: var(--space-md);
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--radius-md);
    margin-top: var(--space-md);
}

.settings-preview p {
    margin-bottom: var(--space-xs);
    font-size: var(--text-sm);
}

/* =============================================
   13. GAME OVER & LEVEL TRANSITION
   ============================================= */
.glass-panel {
    background: var(--card-gradient);
    backdrop-filter: blur(var(--backdrop-blur));
    -webkit-backdrop-filter: blur(var(--backdrop-blur));
}

.game-over-stats-container {
    display: flex;
    justify-content: center;
    margin-bottom: var(--space-lg);
}

.stat-box.main-score {
    padding: var(--space-md) var(--space-xl);
    background: var(--glass-bg);
    border-radius: var(--radius-lg);
    text-align: center;
}

.stat-box .stat-label {
    display: block;
    font-size: var(--text-xs);
    text-transform: uppercase;
    color: var(--color-text-muted);
    margin-bottom: var(--space-xs);
}

.stat-box .stat-value {
    font-size: var(--text-3xl);
    font-weight: 800;
    color: var(--color-accent);
}

.secondary-stats {
    display: flex;
    justify-content: center;
    gap: var(--space-xl);
    margin-bottom: var(--space-lg);
    font-size: var(--text-sm);
}

.leaderboard-section {
    margin-bottom: var(--space-lg);
}

/* === Game Over Wallet & Continue Section === */
.game-over-wallet-section {
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    margin-bottom: var(--space-lg);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.wallet-display {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
    font-size: var(--text-lg);
}

.wallet-label {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    text-transform: uppercase;
}

.wallet-amount {
    font-weight: 800;
    color: #FFD700;
}

.continue-options {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.shop-action-btn {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    width: 100%;
    padding: var(--space-sm) var(--space-md);
    background: linear-gradient(135deg, var(--color-secondary) 0%, #26A69A 100%);
    border: none;
    border-radius: var(--radius-md);
    color: white;
    cursor: pointer;
    transition: all var(--transition-fast);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    text-align: left;
}

.shop-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    filter: brightness(1.1);
}

.shop-action-btn:active {
    transform: translateY(0);
}

.shop-action-btn.disabled {
    opacity: 0.5;
    filter: grayscale(1);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.shop-action-btn .btn-icon {
    font-size: 1.8rem;
}

.shop-action-btn .btn-details {
    display: flex;
    flex-direction: column;
}

.shop-action-btn .btn-title {
    font-weight: 700;
    font-size: var(--text-base);
}

.shop-action-btn .btn-cost {
    font-size: var(--text-xs);
    opacity: 0.9;
}

.feedback-message {
    margin-top: var(--space-sm);
    font-size: var(--text-sm);
    font-weight: 600;
    min-height: 1.5em;
}

.feedback-message.success { color: var(--color-success); }
.feedback-message.error { color: var(--color-warning); }

.leaderboard-section h3 {
    font-size: var(--text-md);
    margin-bottom: var(--space-sm);
}

.leaderboard-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

/* Level Transition */
.level-details {
    padding: var(--space-md);
    background: var(--glass-bg);
    border-radius: var(--radius-md);
    margin: var(--space-md) 0;
}

.level-details p {
    margin-bottom: var(--space-xs);
    font-size: var(--text-sm);
}

#scoring-breakdown {
    margin-top: var(--space-md);
}

/* =============================================
   14. SCROLLBAR STYLING
   ============================================= */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.35);
}

/* Firefox */
* {
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.2) rgba(0, 0, 0, 0.1);
}

/* =============================================
   15. RESPONSIVE BREAKPOINTS
   ============================================= */

/* ===== TABLET & BELOW (< 900px) - Single Column ===== */
@media (max-width: 900px) {
    #game-container {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        gap: var(--space-sm);

        height: 100dvh;
        padding: calc(var(--header-height) + var(--safe-top) + var(--space-xs)) var(--space-sm) calc(var(--space-xs) + var(--safe-bottom));

        overflow: hidden;
    }

    #clock-panel {
        flex: 0 0 auto;
        width: 100%;
        max-height: 30vh;
    }

    .clock-container {
        width: min(50%, 28vh, 220px);
    }

    .clock-status {
        margin-top: var(--space-xs);
        font-size: var(--text-sm);
    }

    #game-panel {
        flex: 1;
        min-height: 0;
        width: 100%;
        max-width: 100%;
        gap: var(--space-xs);
        justify-content: flex-start;
        overflow: hidden;
    }

    #progress-panel {
        flex-direction: row;
        align-items: center;
        justify-content: space-around;
        padding: var(--space-xs) var(--space-sm);
        flex-shrink: 0;
    }

    .level-row {
        display: none;
    }

    .stats-grid {
        display: flex;
        justify-content: space-around;
        width: 100%;
        gap: var(--space-md);
    }

    .stat-item {
        flex-direction: row;
        gap: var(--space-xs);
    }

    .stat-label {
        order: -1;
        font-size: var(--text-xs);
    }

    #question-panel {
        flex: 1;
        min-height: 0;
        justify-content: flex-start;
        gap: var(--space-xs);
    }

    #question-panel h1 {
        font-size: var(--text-lg);
        margin-bottom: var(--space-xs);
    }

    #options {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: var(--space-xs);
        max-width: 340px;
    }

    .option {
        min-height: 44px;
        font-size: var(--text-md);
        aspect-ratio: auto;
        padding: var(--space-sm);
    }
}

/* ===== PORTRAIT MOBILE (< 600px) ===== */
@media (max-width: 600px) {
    :root {
        --header-height: 50px;
    }

    #game-container {
        padding-left: var(--space-sm);
        padding-right: var(--space-sm);
    }

    .clock-container {
        width: min(55%, 30vh, 250px);
    }

    .clock-status {
        font-size: var(--text-md);
    }

    #options {
        max-width: 360px;
        margin: 0 auto;
        gap: var(--space-xs);
    }

    .option {
        min-height: 48px;
        padding: var(--space-sm);
        font-size: var(--text-md);
    }

    .modal-content,
    .start-menu-content {
        padding: var(--space-lg);
    }

    .difficulty-grid {
        gap: var(--space-xs);
    }

    .difficulty-card {
        padding: var(--space-sm);
    }

    .card-icon {
        font-size: 1.5rem;
    }

    .card-description {
        display: none;
    }
}

/* ===== LANDSCAPE MOBILE (Short Height) ===== */
@media (max-height: 550px) and (orientation: landscape) {
    :root {
        --header-height: 48px;
    }

    #game-container {
        display: grid !important;
        grid-template-columns: minmax(200px, 0.4fr) 1fr;
        grid-template-rows: 1fr;
        align-items: center;
        gap: var(--space-sm);

        height: 100dvh;
        padding: calc(var(--header-height) + var(--safe-top) + var(--space-2xs)) var(--space-sm) calc(var(--space-2xs) + var(--safe-bottom));
        padding-left: calc(var(--space-sm) + var(--safe-left));
        padding-right: calc(var(--space-sm) + var(--safe-right));

        overflow: hidden;
    }

    #clock-panel {
        height: 100%;
        max-height: calc(100dvh - var(--header-height) - var(--safe-top) - var(--space-sm));
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .clock-wrapper {
        height: 100%;
        justify-content: center;
    }

    .clock-container {
        width: auto;
        height: min(100%, 80vh);
        max-width: 200px;
        max-height: 200px;
    }

    .clock-status {
        display: none;
    }

    #game-panel {
        display: flex;
        flex-direction: column;
        justify-content: center;
        max-width: none;
        height: 100%;
        gap: var(--space-2xs);
        overflow: hidden;
    }

    #progress-panel {
        padding: var(--space-2xs) var(--space-xs);
        flex-direction: row;
        flex-shrink: 0;
        gap: var(--space-sm);
    }

    .level-row {
        display: none;
    }

    .stats-grid {
        display: flex;
        justify-content: center;
        gap: var(--space-lg);
    }

    .stat-item {
        flex-direction: row;
        gap: var(--space-2xs);
    }

    .stat-label {
        display: none;
    }

    #question-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: var(--space-xs);
        min-height: 0;
    }

    #question-panel h1 {
        font-size: var(--text-md);
        margin: 0;
    }

    #options {
        grid-template-columns: repeat(4, 1fr) !important;
        gap: var(--space-xs);
        max-width: none;
    }

    .option {
        min-height: 36px;
        padding: var(--space-2xs) var(--space-xs);
        font-size: var(--text-sm);
        aspect-ratio: auto;
    }
}

/* ===== VERY SHORT LANDSCAPE (e.g., iPhone SE landscape) ===== */
@media (max-height: 400px) and (orientation: landscape) {
    :root {
        --header-height: 44px;
    }

    .clock-container {
        width: min(80%, 45vh, 200px);
    }

    .clock-status {
        display: none;
    }

    #progress-panel {
        padding: var(--space-2xs) var(--space-xs);
    }

    .badge {
        display: none;
    }

    #options {
        gap: 4px;
    }

    .option {
        min-height: 36px;
        font-size: var(--text-sm);
    }
}

/* ===== LARGE DESKTOP (> 1200px) ===== */
@media (min-width: 1200px) {
    .clock-container {
        width: min(90%, 50vh, 500px);
    }

    #game-panel {
        max-width: 600px;
    }

    .option {
        min-height: 70px;
        font-size: var(--text-xl);
    }
}

/* ===== ULTRA-WIDE SCREENS ===== */
@media (min-width: 1600px) {
    #game-container {
        gap: var(--space-2xl);
    }

    .clock-container {
        width: min(90%, 55vh, 550px);
    }
}

/* ===== PRINT (Hidden) ===== */
@media print {
    body {
        display: none;
    }
}

/* =============================================
   13. DYNAMIC FEEDBACK POPUPS
   ============================================= */
.feedback-popup {
    position: fixed;
    z-index: 2500;
    /* Highest priority */
    pointer-events: none;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease-out;

    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-pill);
    font-weight: 800;
    font-size: var(--text-lg);
    background: rgba(255, 255, 255, 0.95);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);

    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

#score-popup {
    color: #4CAF50;
    /* Green for points */
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

#coin-popup {
    color: #FFD700;
    /* Gold for coins */
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.feedback-popup.show {
    opacity: 1;
    transform: translateY(0);
    animation: popupFloat 1.5s ease-out forwards;
}

@keyframes popupFloat {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.8);
    }

    15% {
        opacity: 1;
        transform: translateY(0) scale(1.1);
    }

    30% {
        transform: translateY(0) scale(1);
    }

    80% {
        opacity: 1;
        transform: translateY(-20px);
    }

    100% {
        opacity: 0;
        transform: translateY(-40px);
    }
}

/* =============================================
   12. REWARD SHOP OVERLAY (Level Transition)
   ============================================= */
.reward-shop-overlay {
    position: fixed;
    inset: 0;
    z-index: 2000;
    /* Higher than level transition modal (1500) */

    display: none;
    background: rgba(0, 0, 0, 0.85);
    /* Slightly darker backdrop */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);

    justify-content: center;
    align-items: center;
    padding: var(--space-md);
}

.reward-shop-overlay.visible {
    display: flex;
    animation: fadeIn 0.3s ease-out;
}

.reward-shop-overlay.hidden {
    display: flex;
    /* Keep display flex for exit animation */
    animation: fadeOut 0.3s ease-out forwards;
}

.shop-overlay-content {
    background: #1E1E32;
    /* Solid dark background */
    background-image: linear-gradient(145deg, rgba(80, 80, 120, 0.15), rgba(40, 40, 60, 0.15));
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    border-radius: var(--radius-xl);

    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.shop-overlay-header {
    padding: var(--space-md);
    background: rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    position: relative;
}

.shop-overlay-header h2 {
    margin: 0;
    font-size: var(--text-lg);
    text-align: center;
    color: var(--color-accent-secondary);
}

.shop-overlay-stats {
    display: flex;
    justify-content: space-around;
    gap: var(--space-md);
    padding: var(--space-xs);
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--radius-lg);
}

.close-shop-overlay {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    background: none;
    border: none;
    color: var(--color-text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.close-shop-overlay:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
}

.shop-overlay-body {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-md);
    overscroll-behavior: contain;
}

.shop-items-overlay {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: var(--space-sm);
}

.shop-item-overlay {
    background: rgba(25, 25, 35, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: var(--radius-lg);
    padding: var(--space-sm);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2xs);
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.shop-item-overlay:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: translateY(-2px);
    border-color: rgba(255, 255, 255, 0.15);
}

.shop-item-overlay .item-icon {
    font-size: 1.8rem;
    margin-bottom: var(--space-2xs);
}

.shop-item-overlay .item-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

.shop-item-overlay .item-description {
    font-size: 0.75rem;
    color: var(--color-text-muted);
}

.shop-item-overlay .item-cost {
    margin-top: var(--space-xs);
    font-size: 0.85rem;
    padding: 2px 8px;
}

.shop-item-overlay.insufficient-funds {
    opacity: 0.5;
    filter: grayscale(0.8);
    cursor: not-allowed;
}

.shop-overlay-footer {
    padding: var(--space-md);
    background: rgba(0, 0, 0, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    align-items: center;
}

.shop-overlay-footer p {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-accent-secondary);
    text-align: center;
}

.continue-level-btn {
    width: 100%;
    padding: var(--space-sm) var(--space-xl);
    background: var(--gradient-primary);
    border: none;
    border-radius: var(--radius-pill);
    color: white;
    font-weight: 700;
    font-size: var(--text-md);
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.continue-level-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    filter: brightness(1.1);
}

.continue-level-btn:active {
    transform: translateY(1px);
}

/* Mobile optimizations for overlay */
@media (max-width: 600px) {
    .shop-items-overlay {
        grid-template-columns: repeat(2, 1fr);
    }

    .shop-overlay-content {
        height: 100%;
        max-height: none;
        border-radius: 0;
    }
}